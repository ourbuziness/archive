<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Mosallas</title>
	<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=0.5, maximum-scale=1">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<link rel="stylesheet" href="nft-style.css">
	<canvas id="whole" style="position: absolute;z-index:999"></canvas>
</head>
<body>

	<audio id="myAudio">
		<source src="win.mp3" type="audio/mpeg"></source>
	</audio>

	<audio id="myAudio1">
		<source src="count.mp3" type="audio/mpeg"></source>
	</audio>
	
	
		<script src="three.min.js"></script>
		<script src="ARnft.js"></script>
        	<script type='text/javascript' src='Tween.js'></script>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
		<script type='text/javascript' src='OrbitControls.js'></script>
		<script src="confetti.js"></script>
	
	
    <script>
      
      let flag = true
      let secondStart = true
      let finished = false 
      let confetiStart = false
      let canPlay = true;
      let nft_loaded 
      let count = 0
      let coffee
      
      let botModel
      let botGltf
      
      let cracker
      let spin
      let win
      let box
      

			ARnft.ARnft.init(800, 600, "archive/DataNFT/kinder", 'config3.json', false, true)
			.then((nft) => {
				nft_loaded = nft;

				document.addEventListener('onInitThreejsRendering', (ev) => {
					const renderer = ev.detail.renderer;
					const scene = ev.detail.scene;
					const camera = ev.detail.camera;
					
  					renderer.outputEncoding = THREE.sRGBEncoding;
                                        renderer.textureEncoding = THREE.sRGBEncoding
					renderer.physicallyCorrectLights = true;
				
					const light1  = new THREE.AmbientLight(0xFFFFFF, 0.3);
					    light1.name = 'ambient_light';
					    camera.add( light1 );

					let directionalLight = new THREE.DirectionalLight(0xFFFFFF, 0.8 * Math.PI);
					directionalLight.position.set(0.5, 0, 0.866);
					camera.add(directionalLight);

				
					nft.addSimpleAnimatedModel('./bot1.glb',128,84,0,28,function loaded(gltf, model){
							
					    botModel = model
					    botGltf = gltf
						
 						model.rotation.x = (Math.PI /2)
						
						window.addEventListener('touchstart', () => {
						   cracker = new Audio('cracker.mp3');
						   spin = new Audio('spin.mp3');
							win = new Audio('win_.mp3');
							box = new Audio('spin.mp3');
							
							cracker.muted = true;
							spin.muted = true;
							win.muted = true;
							box.muted = true;

							cracker.play()
							spin.play()
							box.play()
							win.play()
							
						});
						
						
						nft.setOnObjectClickListener('./bot1.glb',function(){
							try{
								cracker.muted = false
								cracker.play();
								
								spin.muted = false
								spin.play()
								
							 var mixer = new THREE.AnimationMixer(model);
							 var action1 = mixer.clipAction(gltf.animations[1]);
							 var action2 = mixer.clipAction(gltf.animations[2]);
							 var action3 = mixer.clipAction(gltf.animations[3]);
							 var action4 = mixer.clipAction(gltf.animations[4]);
							 var action5 = mixer.clipAction(gltf.animations[5]);
							 var action6 = mixer.clipAction(gltf.animations[6]);
							 var action7 = mixer.clipAction(gltf.animations[7]);
                
							action1.name = "END"
								mixer.addEventListener('finished',function(e){
									
								   	count++
// 									if(count ==7) alert("7")
// 									if(count ==6) alert("6")
// 									if(count ==8) alert("8")
// 									if(count ==9) alert("9")
									
									try{
										if(count == 6 ){
								
											win.muted = false
										win.play();
											
										}
											
										if( e.action.getClip().name == "UniqueID_133.003Action"){
win.pause()
											var mixer = new THREE.AnimationMixer(model);
											var action0 = mixer.clipAction(gltf.animations[0]);
												action0.setLoop(THREE.LoopOnce);
												action0.clampWhenFinished = true;
												action0.play();	
											nft.mixers.push(mixer);
											
											//box = new Audio('box.mp3');
											box.muted = false
											
											box.play()
											
											
											
										}
											
									}catch(e){
										
									}

								 });
								
							 action1.setLoop(THREE.LoopOnce);
   						 action1.clampWhenFinished = true;
							 action1.play();
                
               action2.setLoop(THREE.LoopOnce);
   						 action2.clampWhenFinished = true;
							 action2.play();
               
               action3.setLoop(THREE.LoopOnce);
   						 action3.clampWhenFinished = true;
							 action3.play();
                
               action4.setLoop(THREE.LoopOnce);
   						 action4.clampWhenFinished = true;
							 action4.play();
                
               action5.setLoop(THREE.LoopOnce);
   						 action5.clampWhenFinished = true;
							 action5.play();
                
               action6.setLoop(THREE.LoopOnce);
   						 action6.clampWhenFinished = true;
							 action6.play();
                
               action7.setLoop(THREE.LoopOnce);
   						 action7.clampWhenFinished = true;
							 action7.play();
								
								setTimeout(function() { nft.mixers.push(mixer); }, 1000);
              
							 
							
							}catch(e){
								alert(e);	
							}
						});
					});
				
					
				})
				
			
				document.addEventListener('getMatrixGL_RH', (ev) => {
					try{
						
					}catch(e){
						alert(e)
					}
				});
            });

    </script>
</body>

</html>
