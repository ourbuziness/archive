<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Mosallas</title>
	<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=0.5, maximum-scale=1">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<link rel="stylesheet" href="nft-style.css">
	<img src="mosallas_logo.png" id="imgLogo" height="140" width="140" style="position: absolute;z-index:999"/>
	<canvas id="whole" style="position: absolute;z-index:999"></canvas>
</head>
<body>

	<audio id="myAudio">
		<source src="win.mp3" type="audio/mpeg"></source>
	</audio>

	<audio id="myAudio1">
		<source src="count.mp3" type="audio/mpeg"></source>
	</audio>
	
	
		<script src="three.min.js"></script>
		<script src="ARnft.js"></script>
        	<script type='text/javascript' src='Tween.js'></script>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
		<script type='text/javascript' src='OrbitControls.js'></script>
		<script src="confetti.js"></script>
		<script src="jquery.min.js"></script>

	
	
    <script>
      
      let ps5
      let box
      let flag = true
      let secondStart = true
      let finished = false 
      let confetiStart = false
      let canPlay = true;
      let nft_loaded 
      let lastNumber = 9
      let coffee
      
      function generateCSSString(matrix ){
	   var str = '';
	   str += matrix[0].toFixed(20) + ',';
	   str += matrix[1].toFixed(20) + ',';
	   str += matrix[2].toFixed(20) + ',';
	   str += matrix[3].toFixed(20) + ',';
	   str += matrix[8].toFixed(20) + ',';
	   str += matrix[10].toFixed(20) + ',';
	   str += matrix[9].toFixed(20) + ',';
	   str += matrix[7].toFixed(20) + ',';
	   str += matrix[4].toFixed(20) + ',';
	   str += matrix[6].toFixed(20) + ',';
	   str += matrix[5].toFixed(20) + ',';
	   str += matrix[11].toFixed(20) + ',';
	   str += matrix[12].toFixed(20) + ',';
	   str += matrix[14].toFixed(20) + ',';
	   str += matrix[13].toFixed(20) + ',';
	   str += matrix[15].toFixed(20);

	   return 'matrix3d(' + str + ')';

}
      

			ARnft.ARnft.init(800, 600, "archive/DataNFT/notebook", 'config3.json', false, true)
			.then((nft) => {
				nft_loaded = nft;
				
				document.addEventListener('onInitThreejsRendering', (ev) => {
					const renderer = ev.detail.renderer;
					const scene = ev.detail.scene;
					const camera = ev.detail.camera;
					
  					renderer.outputEncoding = THREE.sRGBEncoding;
                                        renderer.textureEncoding = THREE.sRGBEncoding
					renderer.physicallyCorrectLights = true;
				
					const light1  = new THREE.AmbientLight(0xFFFFFF, 0.3);
					    light1.name = 'ambient_light';
					    camera.add( light1 );

					let directionalLight = new THREE.DirectionalLight(0xFFFFFF, 0.8 * Math.PI);
					directionalLight.position.set(0.5, 0, 0.866);
					camera.add(directionalLight);

					nft.addSimpleModel('./toycar.glb',190,140,0,100,function loaded(model){
						model.rotation.y = -Math.PI /2
						nft.setOnObjectClickListener('./flight_info.glb' , function() {
							window.open('https://www.filimo.com/m/nrWsV', '_blank').focus()
						});
						
					});
				
					nft.addSimpleAnimatedModel('./PLANE4.glb',190,280,0,14,function loaded(gltf, model){
							
//  						model.rotation.x = 42*Math.PI/180;
						nft.tickExtend = function (){
// 								model.rotation.y += 0.005
						};
						
						model.rotation.y = (Math.PI /4)
						
						nft.setOnObjectClickListener('./PLANE4.glb',function(){
							try{
							 var mixer = new THREE.AnimationMixer(model);
							 var action = mixer.clipAction(gltf.animations[0]);
							 action.setLoop(THREE.LoopOnce);
   							 action.clampWhenFinished = true;
							 action.play();
							 nft.mixers.push(mixer);
							}catch(e){
								alert(e);	
							}
						});
					});
				
					
				})
				
			
				document.addEventListener('getMatrixGL_RH', (ev) => {
					try{
						var matrix = ev.detail.matrixGL_RH;
            					 $('#imgLogo').css('transform', generateCSSString(matrix));
            
					}catch(e){
						alert(e)
					}
				});
            });

    </script>
</body>

</html>
