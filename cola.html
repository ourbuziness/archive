<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Mosallas</title>
	<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=0.5, maximum-scale=1">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<link rel="stylesheet" href="nft-style.css">
	<canvas id="whole" style="position: absolute;z-index:999"></canvas>
</head>
<body>

	<audio id="myAudio">
		<source src="door.mp3" type="audio/mpeg"></source>
	</audio>

	<audio id="myAudio1">
		<source src="celebrate.mp3" type="audio/mpeg"></source>
	</audio>
	
	
		<script src="three.min.js"></script>
		<script src="ARnft.js"></script>
        	<script type='text/javascript' src='Tween.js'></script>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
		<script type='text/javascript' src='OrbitControls.js'></script>
		<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.4.0/dist/confetti.browser.min.js"></script>
	
	
    <script>
      
      let ps5
      let box
      let flag = true
      let secondStart = true
      let finished = false 
      let confetiStart = false
      let canPlay = true;
      let nft_loaded 
     
      
      function celebrate(){ 
   
var end = Date.now() + (2 * 1000);
// go Buckeyes!
var colors = ['#bb0000', '#ffffff'];
(function frame() {
  confetti({
    particleCount: 5,
    angle: 60,
    spread: 55,
    origin: { x: 0 }
    //colors: colors
  });
  confetti({
    particleCount: 5,
    angle: 120,
    spread: 55,
    origin: { x: 1 }
    //colors: colors
  });
  if (Date.now() < end) {
    requestAnimationFrame(frame);
  }
}());

      
      
      
      }

			ARnft.ARnft.init(800, 600, "archive/DataNFT/cola14", 'config3.json', false, true)
			.then((nft) => {
				nft_loaded = nft;
				
				document.addEventListener('onInitThreejsRendering', (ev) => {
					const renderer = ev.detail.renderer;
					const scene = ev.detail.scene;
					const camera = ev.detail.camera;
					
  					renderer.outputEncoding = THREE.sRGBEncoding;
                                        renderer.textureEncoding = THREE.sRGBEncoding
					renderer.physicallyCorrectLights = true;
				
					const light1  = new THREE.AmbientLight(0xFFFFFF, 0.3);
					    light1.name = 'ambient_light';
					    camera.add( light1 );

					let directionalLight = new THREE.DirectionalLight(0xFFFFFF, 0.8 * Math.PI);
					directionalLight.position.set(0.5,0,0.866);
					camera.add(directionalLight);
					
					window.addEventListener('touchstart', () => {
					    document.getElementById('myAudio').muted = false
					     document.getElementById('myAudio').muted = true
					    document.getElementById('myAudio').play() 

					  });
					
					nft.addSimpleAnimatedModel('./coin.glb',56,14,-14,2,function(gltf,model){
						
						 nft.setOnObjectClickListener('./coin.glb',function(){
							 document.getElementById('myAudio1').muted = false
					     //document.getElementById('myAudio').muted = true
					   // document.getElementById('myAudio').play() 
							 document.getElementById('myAudio1').play() 
							 
							var mixer = new THREE.AnimationMixer(model);
							 var actionch = mixer.clipAction(gltf.animations[1]);
							 var action0 = mixer.clipAction(gltf.animations[0]);
						var action1 = mixer.clipAction(gltf.animations[2]);
						action0.setLoop(THREE.LoopOnce);
   							 action0.clampWhenFinished = true;
							 action0.play();
							 
							 action1.setLoop(THREE.LoopOnce);
   							 action1.clampWhenFinished = true;
							 action1.play();

							 actionch.setLoop(THREE.LoopRepeat);
   							// action1.clampWhenFinished = true;
							 actionch.play();
							
						
						nft.mixers.push(mixer);
							 celebrate();
						 });
						
					});
					
					nft.addSimpleAnimatedModel('./coca1.glb' , 72 , -10 ,-56, 58 , function(gltf,model){
						
							box = model;
							//box.rotation.x = (Math.PI / 2);
 							box.rotation.y = (-1*Math.PI /4);

							nft.setOnObjectClickListener('./coca1.glb',function(){
							try{
								document.getElementById('myAudio').muted = false
					  //   document.getElementById('myAudio').muted = true
					//    document.getElementById('myAudio').play() 
								document.getElementById('myAudio').play() 
								
								
							 var mixer = new THREE.AnimationMixer(model);
							 var action = mixer.clipAction(gltf.animations[0]);
							 var action1 = mixer.clipAction(gltf.animations[1]);
								var action2 = mixer.clipAction(gltf.animations[2]);
								var action3 = mixer.clipAction(gltf.animations[3]);
							 action.setLoop(THREE.LoopOnce);
   							 action.clampWhenFinished = true;
							 action.play();

							 action1.setLoop(THREE.LoopOnce);
   							 action1.clampWhenFinished = true;
							 action1.play();
								
								action2.setLoop(THREE.LoopOnce);
   							 action2.clampWhenFinished = true;
							 action2.play();
								
								action3.setLoop(THREE.LoopOnce);
   							 action3.clampWhenFinished = true;
							 action3.play();
								
								document.getElementById('myAudio1').muted = false
					     document.getElementById('myAudio1').muted = true
					    document.getElementById('myAudio1').play() 

							 nft.mixers.push(mixer);
							}catch(e){
								alert(e);	
							}
						});
						
					});		
					
				})
				
			
				document.addEventListener('getMatrixGL_RH', (ev) => {
					try{
						// if(flag){
						// 	flag = false
						// 	tween1.start()
						
						// }
					}catch(e){
						alert(e)
					}
				});
            });

    </script>
</body>

</html>
